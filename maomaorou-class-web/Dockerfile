FROM node:18.19.0 as base
WORKDIR /app
COPY package*.json ./
EXPOSE 3100

FROM base as production
COPY . .

ARG PORT
ARG BACKEND_URL
ARG NEXT_PUBLIC_BACKEND_URL

RUN echo "PORT: $PORT"
RUN echo "BACKEND_URL: $BACKEND_URL" 
RUN echo "NEXT_PUBLIC_BACKEND_URL: $NEXT_PUBLIC_BACKEND_URL"

ENV PORT=$PORT
ENV BACKEND_URL=$BACKEND_URL
ENV NEXT_PUBLIC_BACKEND_URL=$NEXT_PUBLIC_BACKEND_URL

RUN npm install
RUN npm run build

CMD ["npm", "run", "start"]
